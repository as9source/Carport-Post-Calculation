<!-- conc.html（index.html と同じフォルダ） -->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>生コン量計算（四角穴・柱差引 a×b）</title>

<link rel="stylesheet" href="./popup.css" />

<style>
  .wrap { max-width: 640px; margin: 20px auto; }
  .card { background:#fff; border:1px solid #ddd; border-radius:12px; padding:20px; }
  .title { margin:0 0 10px; font-size:1.2rem; }
  label { display:block; margin-top:12px; font-size:.95rem; font-weight:500; }
  input[type="number"] { width:100%; padding:10px; margin-top:6px; border:1px solid #ddd; border-radius:8px; font-size:1rem; }
  .row { display:flex; align-items:center; gap:10px; }
  .linker { display:flex; align-items:center; gap:6px; font-size:.9rem; color:#555; user-select:none; }
  .btn { display:inline-block; padding:12px 16px; border-radius:10px; border:1px solid #d6d6d6; background:#fff; color:#222;
         font-weight:700; cursor:pointer; text-decoration:none; }
  .btn + .btn { margin-left:8px; }
  .btn-row { display:flex; gap:8px; flex-wrap:wrap; margin-top:14px; }
  .btn-primary{ background:var(--accent); border-color:var(--accent); color:var(--accent-contrast); }
  .btn-primary:hover{ background:var(--accent-pressed); border-color:var(--accent-pressed); }
  .result { margin-top:16px; padding:12px; background:#eef4fb; border:1px solid #c6d8f0; border-radius:10px; line-height:1.6; }
  .muted { color:#666; font-size:.9rem; }
  .pill { display:inline-block; padding:2px 10px; border-radius:999px; background:#f2f2f2; border:1px solid #e5e5e5; font-size:.8rem; color:#555; }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1 class="title">生コン量計算</h1>
    <p class="muted">単位は <span class="pill">mm で入力</span>、出力は <span class="pill">m³</span>です。</p>

    <!-- 穴（四角） -->
    <label>穴の長辺 L（mm）</label>
    <div class="row">
      <input type="number" id="hole_l" min="0" inputmode="numeric" placeholder="例: 500">
      <label class="linker" title="LとWを同じ値にする（正方形が多い場合に便利）">
        <input type="checkbox" id="linkLW" checked>
        L=W を連動
      </label>
    </div>

    <label>穴の短辺 W（mm）<span class="muted">（連動ONなら自動入力／長方形はWを書き換え）</span></label>
    <input type="number" id="hole_w" min="0" inputmode="numeric" placeholder="例: 500">

    <label>穴高さ H（mm）</label>
    <input type="number" id="hole_h" min="0" inputmode="numeric" placeholder="例: 550">

    <!-- 柱（長方形 a×b） -->
    <label>柱の一辺 a（mm）</label>
    <div class="row">
      <input type="number" id="post_a" min="0" inputmode="numeric" placeholder="例: 125">
      <label class="linker" title="aとbを同じ値にする（角柱が多い場合に便利）">
        <input type="checkbox" id="linkAB" checked>
        a=b を連動
      </label>
    </div>

    <label>柱のもう一辺 b（mm）<span class="muted">（連動ONなら自動入力／長方形はbを書き換え）</span></label>
    <input type="number" id="post_b" min="0" inputmode="numeric" placeholder="例: 125">

    <!-- 本数 -->
    <label>柱の本数 N（本）</label>
    <input type="number" id="posts" min="0" step="1" inputmode="numeric" placeholder="例: 4">

    <div class="btn-row">
      <button type="button" class="btn btn-primary" id="calcBtn">計算する</button>
      <button type="button" class="btn" id="backBtn">柱ピッチ計算に戻る</button>
    </div>

    <div id="out" class="result" aria-live="polite">
      <strong>穴1つ分：</strong> 0.000 m³<br>
      <strong>全部（0本）：</strong> 0.000 m³
    </div>
  </div>
</div>

<script>
(function(){
  // 要素取得
  const lEl = document.getElementById("hole_l");
  const wEl = document.getElementById("hole_w");
  const hEl = document.getElementById("hole_h");
  const aEl = document.getElementById("post_a");
  const bEl = document.getElementById("post_b");
  const nEl = document.getElementById("posts");
  const linkLW = document.getElementById("linkLW");
  const linkAB = document.getElementById("linkAB");
  const out = document.getElementById("out");

  // 数値変換（空欄やNaNは0）
  const toNum = el => {
    const v = Number(el.value);
    return (Number.isFinite(v) && v >= 0) ? v : 0;
  };
  const mm3_to_m3 = v => v / 1_000_000_000;

  // --- L→W 連動 ---
  function syncLW(){
    if(linkLW.checked){
      wEl.value = lEl.value;
    }
  }
  lEl.addEventListener("input",  syncLW);
  lEl.addEventListener("change", syncLW);
  linkLW.addEventListener("change", ()=>{
    if(linkLW.checked){ syncLW(); }
  });

  // --- a→b 連動 ---
  function syncAB(){
    if(linkAB.checked){
      bEl.value = aEl.value;
    }
  }
  aEl.addEventListener("input",  syncAB);
  aEl.addEventListener("change", syncAB);
  linkAB.addEventListener("change", ()=>{
    if(linkAB.checked){ syncAB(); }
  });

  // 計算
  function calc(){
    // 連動ONで、かつ相手が空欄なら計算前に補完
    if(linkLW.checked && !wEl.value){ wEl.value = lEl.value; }
    if(linkAB.checked && !bEl.value){ bEl.value = aEl.value; }

    const L = toNum(lEl), W = toNum(wEl), H = toNum(hEl);
    const a = toNum(aEl), b = toNum(bEl), N = toNum(nEl);

    const V_hole = L * W * H;  // mm³
    const V_post = a * b * H;  // mm³
    const V1     = Math.max(0, V_hole - V_post);

    const m3_1 = mm3_to_m3(V1);
    const m3_T = m3_1 * N;

    out.innerHTML =
      `<strong>穴1つ分：</strong> ${m3_1.toFixed(3)} m³<br>` +
      `<strong>全部（${N}本）：</strong> ${m3_T.toFixed(3)} m³`;
  }

  document.getElementById("calcBtn").addEventListener("click", calc);
  document.getElementById("backBtn").addEventListener("click", ()=>{ location.href = "index.html"; });
})();
</script>
</body>
</html>
